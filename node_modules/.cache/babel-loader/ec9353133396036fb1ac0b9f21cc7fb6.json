{"ast":null,"code":"var _jsxFileName = \"/home/dmitriy/WebstormProjects/react-mesto-auth/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport { useEffect, useState } from \"react\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport { renderResponse } from \"../utils/apiFunctions\";\nimport { api } from \"../utils/Api\";\nimport { EditProfilePopup } from \"./EditProfilePopup\";\nimport { EditAvatarPopup } from \"./EditAvatarPopup\";\nimport { AddPlacePopup } from \"./AddPlacePopup\";\nimport { Route, Switch } from 'react-router-dom';\nimport { ProtectedComponent } from \"./ProtectedComponent\";\nimport { Register } from \"./Register\";\nimport { Login } from \"./Login\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [currentUser, setCurrentUser] = useState({\n    about: '',\n    avatar: '',\n    cohort: '',\n    name: '',\n    _id: '',\n    isLoggedIn: false\n  });\n  const [isLoggedIn, setIsLoggedIn] = useState(true); // стейт для определения метоположения в приложении\n\n  useEffect(() => {\n    renderResponse(api.getUserInfo(), data => {\n      setCurrentUser({ ...currentUser,\n        about: data.about,\n        avatar: data.avatar,\n        cohort: data.cohort,\n        name: data.name,\n        _id: data._id\n      });\n    }, \"#\");\n  }, []);\n  const [editProfileState, setEditProfileState] = useState(false);\n  const [editAvatarState, setEditAvatarState] = useState(false);\n  const [addPlaceState, setAddPlaceState] = useState(false);\n  const [selectedCard, setSelectedCard] = useState({});\n  const [isLoading, setIsLoading] = useState(false);\n\n  function finallyHandler() {\n    setIsLoading(false);\n  } // стейт карточек\n\n\n  const [cards, setCards] = useState([]);\n  useEffect(() => {\n    renderResponse(api.getPreloadsCards(), data => {\n      setCards(data);\n    }, \"#\");\n  }, []); // функции обратного вызова для управления поведением карточки\n\n  const handleCardLike = card => {\n    const isLiked = card.likes.some(like => like._id === currentUser._id);\n    renderResponse(api.changeLikeCardStatus(card._id, !isLiked), newCard => {\n      setCards(prevState => {\n        return prevState.map(stateItem => {\n          return stateItem._id === card._id ? newCard : stateItem;\n        });\n      });\n    }, finallyHandler);\n  };\n\n  const handleCardDelete = card => {\n    renderResponse(api.deleteCard(card._id), () => {\n      setCards(prevState => {\n        return prevState.filter(stateItem => stateItem._id !== card._id);\n      });\n    }, finallyHandler);\n  };\n\n  const handleAddMestoCard = _ref => {\n    let {\n      name,\n      link\n    } = _ref;\n    setIsLoading(true);\n    renderResponse(api.postCard({\n      name: name,\n      link: link\n    }), newCardData => {\n      setCards([newCardData, ...cards]);\n      setIsLoading(false);\n      closeAllPopups();\n    }, finallyHandler);\n  }; // функции обратного вызова для управления данными пользователя\n\n\n  const handleUpdateUser = _ref2 => {\n    let {\n      name,\n      about\n    } = _ref2;\n    setIsLoading(true);\n    renderResponse(api.updateUserInfo({\n      fio: name,\n      aboutYourself: about\n    }), data => {\n      setCurrentUser({ ...currentUser,\n        name: data.name,\n        about: data.about\n      });\n      setIsLoading(false);\n      closeAllPopups();\n    }, finallyHandler);\n  };\n\n  const handleUpdateAvatar = _ref3 => {\n    let {\n      avatar\n    } = _ref3;\n    setIsLoading(true);\n    renderResponse(api.updateAvatar({\n      avatar\n    }), data => {\n      setCurrentUser({ ...currentUser,\n        avatar: data.avatar\n      });\n      setIsLoading(false);\n      closeAllPopups();\n    }, finallyHandler);\n  }; // функции обратного вызова для окткрытия/закрытия попапов\n\n\n  const handleEditAvatarClick = () => {\n    setEditAvatarState(true);\n  };\n\n  const handleEditProfileClick = () => {\n    setEditProfileState(true);\n  };\n\n  const handleAddPlaceClick = () => {\n    setAddPlaceState(true);\n  };\n\n  const closeAllPopups = () => {\n    setEditProfileState(false);\n    setAddPlaceState(false);\n    setEditAvatarState(false);\n    setSelectedCard({});\n  };\n\n  const handleCardClick = card => {\n    setSelectedCard(card);\n  };\n\n  return /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: currentUser,\n    children: [/*#__PURE__*/_jsxDEV(Switch, {\n      children: [/*#__PURE__*/_jsxDEV(ProtectedComponent, {\n        component: Main,\n        path: \"/\",\n        exact: true,\n        isLoggedIn: isLoggedIn,\n        onEditProfile: handleEditProfileClick,\n        onAddPlace: handleAddPlaceClick,\n        onEditAvatar: handleEditAvatarClick,\n        onCardClick: handleCardClick,\n        onCardLike: handleCardLike,\n        onCardDelete: handleCardDelete,\n        cards: cards\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/sign-up\",\n        children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 19\n        }, this), /*#__PURE__*/_jsxDEV(Register, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 19\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/sign-in\",\n        children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 19\n        }, this), /*#__PURE__*/_jsxDEV(Login, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 19\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 15\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n      isOpen: editProfileState,\n      onClose: closeAllPopups,\n      onUserUpdate: handleUpdateUser,\n      isLoading: isLoading\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n      isOpen: editAvatarState,\n      onClose: closeAllPopups,\n      onUpdateAvatar: handleUpdateAvatar,\n      isLoading: isLoading\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n      isOpen: addPlaceState,\n      onClose: closeAllPopups,\n      onAddCard: handleAddMestoCard,\n      isLoading: isLoading\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(PopupWithForm, {\n      name: \"confirm\",\n      title: \"Вы уверены?\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n      card: selectedCard,\n      onClose: closeAllPopups\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 11\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 7\n  }, this);\n}\n\n_s(App, \"QL0b1/OTG7iiWyNX0AkLg/YZu68=\");\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/home/dmitriy/WebstormProjects/react-mesto-auth/src/components/App.js"],"names":["Header","Main","Footer","PopupWithForm","ImagePopup","useEffect","useState","CurrentUserContext","renderResponse","api","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Route","Switch","ProtectedComponent","Register","Login","App","currentUser","setCurrentUser","about","avatar","cohort","name","_id","isLoggedIn","setIsLoggedIn","getUserInfo","data","editProfileState","setEditProfileState","editAvatarState","setEditAvatarState","addPlaceState","setAddPlaceState","selectedCard","setSelectedCard","isLoading","setIsLoading","finallyHandler","cards","setCards","getPreloadsCards","handleCardLike","card","isLiked","likes","some","like","changeLikeCardStatus","newCard","prevState","map","stateItem","handleCardDelete","deleteCard","filter","handleAddMestoCard","link","postCard","newCardData","closeAllPopups","handleUpdateUser","updateUserInfo","fio","aboutYourself","handleUpdateAvatar","updateAvatar","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick"],"mappings":";;;AAAA,OAAOA,MAAP,MAAmB,UAAnB;AACA,OAAOC,IAAP,MAAiB,QAAjB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,SAAQC,SAAR,EAAmBC,QAAnB,QAAkC,OAAlC;AACA,SAAQC,kBAAR,QAAiC,gCAAjC;AACA,SAAQC,cAAR,QAA6B,uBAA7B;AACA,SAAQC,GAAR,QAAkB,cAAlB;AACA,SAAQC,gBAAR,QAA+B,oBAA/B;AACA,SAAQC,eAAR,QAA8B,mBAA9B;AACA,SAAQC,aAAR,QAA4B,iBAA5B;AACA,SAAQC,KAAR,EAAeC,MAAf,QAA4B,kBAA5B;AACA,SAAQC,kBAAR,QAAiC,sBAAjC;AACA,SAAQC,QAAR,QAAuB,YAAvB;AACA,SAAQC,KAAR,QAAoB,SAApB;;;AAGA,SAASC,GAAT,GAAe;AAAA;;AAEX,QAAM,CAACC,WAAD,EAAcC,cAAd,IAAgCd,QAAQ,CAAC;AAACe,IAAAA,KAAK,EAAE,EAAR;AAAYC,IAAAA,MAAM,EAAE,EAApB;AAAwBC,IAAAA,MAAM,EAAC,EAA/B;AAAmCC,IAAAA,IAAI,EAAC,EAAxC;AAA4CC,IAAAA,GAAG,EAAE,EAAjD;AAAqDC,IAAAA,UAAU,EAAE;AAAjE,GAAD,CAA9C;AACA,QAAM,CAACA,UAAD,EAAaC,aAAb,IAA8BrB,QAAQ,CAAC,IAAD,CAA5C,CAHW,CAIX;;AAEAD,EAAAA,SAAS,CAAC,MAAM;AACZG,IAAAA,cAAc,CAACC,GAAG,CAACmB,WAAJ,EAAD,EAAqBC,IAAD,IAAU;AACxCT,MAAAA,cAAc,CAAC,EAAC,GAAGD,WAAJ;AAAiBE,QAAAA,KAAK,EAAEQ,IAAI,CAACR,KAA7B;AAAoCC,QAAAA,MAAM,EAAEO,IAAI,CAACP,MAAjD;AAAyDC,QAAAA,MAAM,EAAEM,IAAI,CAACN,MAAtE;AAA8EC,QAAAA,IAAI,EAAEK,IAAI,CAACL,IAAzF;AAA+FC,QAAAA,GAAG,EAAEI,IAAI,CAACJ;AAAzG,OAAD,CAAd;AACH,KAFa,EAEX,GAFW,CAAd;AAGH,GAJQ,EAIN,EAJM,CAAT;AAKA,QAAM,CAACK,gBAAD,EAAmBC,mBAAnB,IAA0CzB,QAAQ,CAAC,KAAD,CAAxD;AACA,QAAM,CAAC0B,eAAD,EAAkBC,kBAAlB,IAAwC3B,QAAQ,CAAC,KAAD,CAAtD;AACA,QAAM,CAAC4B,aAAD,EAAgBC,gBAAhB,IAAoC7B,QAAQ,CAAC,KAAD,CAAlD;AACA,QAAM,CAAC8B,YAAD,EAAeC,eAAf,IAAkC/B,QAAQ,CAAC,EAAD,CAAhD;AACA,QAAM,CAACgC,SAAD,EAAYC,YAAZ,IAA4BjC,QAAQ,CAAC,KAAD,CAA1C;;AACC,WAAWkC,cAAX,GAA2B;AACxBD,IAAAA,YAAY,CAAC,KAAD,CAAZ;AACH,GAlBU,CAmBX;;;AACA,QAAM,CAACE,KAAD,EAAQC,QAAR,IAAoBpC,QAAQ,CAAC,EAAD,CAAlC;AACAD,EAAAA,SAAS,CAAC,MAAM;AACZG,IAAAA,cAAc,CAACC,GAAG,CAACkC,gBAAJ,EAAD,EAA0Bd,IAAD,IAAQ;AAC3Ca,MAAAA,QAAQ,CAACb,IAAD,CAAR;AACH,KAFa,EAEX,GAFW,CAAd;AAGH,GAJQ,EAIN,EAJM,CAAT,CArBW,CA0BX;;AACA,QAAMe,cAAc,GAAIC,IAAD,IAAU;AAC7B,UAAMC,OAAO,GAAGD,IAAI,CAACE,KAAL,CAAWC,IAAX,CAAgBC,IAAI,IAAIA,IAAI,CAACxB,GAAL,KAAaN,WAAW,CAACM,GAAjD,CAAhB;AAEAjB,IAAAA,cAAc,CAACC,GAAG,CAACyC,oBAAJ,CAAyBL,IAAI,CAACpB,GAA9B,EAAmC,CAACqB,OAApC,CAAD,EAA+CK,OAAO,IAAI;AACpET,MAAAA,QAAQ,CAAEU,SAAD,IAAe;AACpB,eAAOA,SAAS,CAACC,GAAV,CAAeC,SAAS,IAAI;AAC/B,iBAAOA,SAAS,CAAC7B,GAAV,KAAkBoB,IAAI,CAACpB,GAAvB,GAA6B0B,OAA7B,GAAuCG,SAA9C;AACH,SAFM,CAAP;AAGH,OAJO,CAAR;AAKH,KANa,EAMXd,cANW,CAAd;AAOH,GAVD;;AAYA,QAAMe,gBAAgB,GAAIV,IAAD,IAAU;AAE/BrC,IAAAA,cAAc,CAACC,GAAG,CAAC+C,UAAJ,CAAeX,IAAI,CAACpB,GAApB,CAAD,EAA2B,MAAM;AAC3CiB,MAAAA,QAAQ,CAACU,SAAS,IAAI;AAClB,eAAOA,SAAS,CAACK,MAAV,CAAkBH,SAAS,IAAIA,SAAS,CAAC7B,GAAV,KAAkBoB,IAAI,CAACpB,GAAtD,CAAP;AACH,OAFO,CAAR;AAGH,KAJa,EAIXe,cAJW,CAAd;AAMH,GARD;;AAUA,QAAMkB,kBAAkB,GAAG,QAAkB;AAAA,QAAjB;AAAClC,MAAAA,IAAD;AAAOmC,MAAAA;AAAP,KAAiB;AACzCpB,IAAAA,YAAY,CAAC,IAAD,CAAZ;AACA/B,IAAAA,cAAc,CAACC,GAAG,CAACmD,QAAJ,CAAa;AAACpC,MAAAA,IAAI,EAAEA,IAAP;AAAamC,MAAAA,IAAI,EAAEA;AAAnB,KAAb,CAAD,EAAyCE,WAAW,IAAI;AAClEnB,MAAAA,QAAQ,CAAC,CAACmB,WAAD,EAAc,GAAGpB,KAAjB,CAAD,CAAR;AACAF,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACAuB,MAAAA,cAAc;AACjB,KAJa,EAIXtB,cAJW,CAAd;AAKH,GAPD,CAjDW,CA0DX;;;AAEA,QAAMuB,gBAAgB,GAAG,SAAmB;AAAA,QAAlB;AAACvC,MAAAA,IAAD;AAAOH,MAAAA;AAAP,KAAkB;AACxCkB,IAAAA,YAAY,CAAC,IAAD,CAAZ;AACA/B,IAAAA,cAAc,CAACC,GAAG,CAACuD,cAAJ,CAAmB;AAACC,MAAAA,GAAG,EAAEzC,IAAN;AAAY0C,MAAAA,aAAa,EAAE7C;AAA3B,KAAnB,CAAD,EAAuDQ,IAAI,IAAI;AACzET,MAAAA,cAAc,CAAC,EAAC,GAAGD,WAAJ;AAAiBK,QAAAA,IAAI,EAAEK,IAAI,CAACL,IAA5B;AAAkCH,QAAAA,KAAK,EAAEQ,IAAI,CAACR;AAA9C,OAAD,CAAd;AACAkB,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACAuB,MAAAA,cAAc;AACjB,KAJa,EAIXtB,cAJW,CAAd;AAMH,GARD;;AAUA,QAAM2B,kBAAkB,GAAG,SAAc;AAAA,QAAb;AAAC7C,MAAAA;AAAD,KAAa;AACrCiB,IAAAA,YAAY,CAAC,IAAD,CAAZ;AACA/B,IAAAA,cAAc,CAACC,GAAG,CAAC2D,YAAJ,CAAiB;AAAC9C,MAAAA;AAAD,KAAjB,CAAD,EAA6BO,IAAI,IAAI;AAC/CT,MAAAA,cAAc,CAAC,EAAC,GAAGD,WAAJ;AAAiBG,QAAAA,MAAM,EAAEO,IAAI,CAACP;AAA9B,OAAD,CAAd;AACAiB,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACAuB,MAAAA,cAAc;AACjB,KAJa,EAIXtB,cAJW,CAAd;AAKH,GAPD,CAtEW,CAgFX;;;AACA,QAAM6B,qBAAqB,GAAG,MAAM;AAChCpC,IAAAA,kBAAkB,CAAC,IAAD,CAAlB;AACH,GAFD;;AAGA,QAAMqC,sBAAsB,GAAG,MAAM;AACjCvC,IAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACH,GAFD;;AAGA,QAAMwC,mBAAmB,GAAG,MAAM;AAC9BpC,IAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACH,GAFD;;AAGA,QAAM2B,cAAc,GAAG,MAAM;AACzB/B,IAAAA,mBAAmB,CAAC,KAAD,CAAnB;AACAI,IAAAA,gBAAgB,CAAC,KAAD,CAAhB;AACAF,IAAAA,kBAAkB,CAAC,KAAD,CAAlB;AACAI,IAAAA,eAAe,CAAC,EAAD,CAAf;AACH,GALD;;AAOA,QAAMmC,eAAe,GAAI3B,IAAD,IAAU;AAC9BR,IAAAA,eAAe,CAACQ,IAAD,CAAf;AACH,GAFD;;AAKF,sBACI,QAAC,kBAAD,CAAoB,QAApB;AAA6B,IAAA,KAAK,EAAE1B,WAApC;AAAA,4BAGI,QAAC,MAAD;AAAA,8BAEI,QAAC,kBAAD;AAAoB,QAAA,SAAS,EAAElB,IAA/B;AACoB,QAAA,IAAI,EAAC,GADzB;AAEoB,QAAA,KAAK,EAAE,IAF3B;AAGoB,QAAA,UAAU,EAAEyB,UAHhC;AAIoB,QAAA,aAAa,EAAE4C,sBAJnC;AAKoB,QAAA,UAAU,EAAEC,mBALhC;AAMoB,QAAA,YAAY,EAAEF,qBANlC;AAOoB,QAAA,WAAW,EAAEG,eAPjC;AAQoB,QAAA,UAAU,EAAE5B,cARhC;AASoB,QAAA,YAAY,EAAEW,gBATlC;AAUoB,QAAA,KAAK,EAAEd;AAV3B;AAAA;AAAA;AAAA;AAAA,cAFJ,eAaI,QAAC,KAAD;AAAO,QAAA,IAAI,EAAC,UAAZ;AAAA,gCACI,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,gBADJ,eAEI,QAAC,QAAD;AAAA;AAAA;AAAA;AAAA,gBAFJ;AAAA;AAAA;AAAA;AAAA;AAAA,cAbJ,eAiBI,QAAC,KAAD;AAAO,QAAA,IAAI,EAAC,UAAZ;AAAA,gCACI,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,gBADJ,eAEI,QAAC,KAAD;AAAA;AAAA;AAAA;AAAA,gBAFJ;AAAA;AAAA;AAAA;AAAA;AAAA,cAjBJ;AAAA;AAAA;AAAA;AAAA;AAAA,YAHJ,eAyBE,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,YAzBF,eA0BI,QAAC,gBAAD;AAAkB,MAAA,MAAM,EAAEX,gBAA1B;AACkB,MAAA,OAAO,EAAEgC,cAD3B;AAEkB,MAAA,YAAY,EAAEC,gBAFhC;AAGkB,MAAA,SAAS,EAAEzB;AAH7B;AAAA;AAAA;AAAA;AAAA,YA1BJ,eA+BI,QAAC,eAAD;AAAiB,MAAA,MAAM,EAAEN,eAAzB;AACiB,MAAA,OAAO,EAAE8B,cAD1B;AAEiB,MAAA,cAAc,EAAEK,kBAFjC;AAGiB,MAAA,SAAS,EAAE7B;AAH5B;AAAA;AAAA;AAAA;AAAA,YA/BJ,eAoCI,QAAC,aAAD;AAAe,MAAA,MAAM,EAAEJ,aAAvB;AACe,MAAA,OAAO,EAAE4B,cADxB;AAEe,MAAA,SAAS,EAAEJ,kBAF1B;AAGe,MAAA,SAAS,EAAEpB;AAH1B;AAAA;AAAA;AAAA;AAAA,YApCJ,eAyCI,QAAC,aAAD;AAAe,MAAA,IAAI,EAAE,SAArB;AAAgC,MAAA,KAAK,EAAE;AAAvC;AAAA;AAAA;AAAA;AAAA,YAzCJ,eA2CI,QAAC,UAAD;AAAY,MAAA,IAAI,EAAEF,YAAlB;AAAgC,MAAA,OAAO,EAAE0B;AAAzC;AAAA;AAAA;AAAA;AAAA,YA3CJ;AAAA;AAAA;AAAA;AAAA;AAAA,UADJ;AAgDD;;GAtJQ5C,G;;KAAAA,G;AAwJT,eAAeA,GAAf","sourcesContent":["import Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport {useEffect, useState} from \"react\";\nimport {CurrentUserContext} from \"../contexts/CurrentUserContext\";\nimport {renderResponse} from \"../utils/apiFunctions\";\nimport {api} from \"../utils/Api\";\nimport {EditProfilePopup} from \"./EditProfilePopup\";\nimport {EditAvatarPopup} from \"./EditAvatarPopup\";\nimport {AddPlacePopup} from \"./AddPlacePopup\";\nimport {Route, Switch} from 'react-router-dom'\nimport {ProtectedComponent} from \"./ProtectedComponent\";\nimport {Register} from \"./Register\";\nimport {Login} from \"./Login\";\n\n\nfunction App() {\n\n    const [currentUser, setCurrentUser] = useState({about: '', avatar: '', cohort:'', name:'', _id: '', isLoggedIn: false});\n    const [isLoggedIn, setIsLoggedIn] = useState(true);\n    // стейт для определения метоположения в приложении\n\n    useEffect(() => {\n        renderResponse(api.getUserInfo(), (data) => {\n            setCurrentUser({...currentUser, about: data.about, avatar: data.avatar, cohort: data.cohort, name: data.name, _id: data._id});\n        }, \"#\")\n    }, []);\n    const [editProfileState, setEditProfileState] = useState(false);\n    const [editAvatarState, setEditAvatarState] = useState(false);\n    const [addPlaceState, setAddPlaceState] = useState(false);\n    const [selectedCard, setSelectedCard] = useState({});\n    const [isLoading, setIsLoading] = useState(false);\n     function   finallyHandler(){\n        setIsLoading(false);\n    }\n    // стейт карточек\n    const [cards, setCards] = useState([]);\n    useEffect(() => {\n        renderResponse(api.getPreloadsCards(), (data)=>{\n            setCards(data);\n        }, \"#\")\n    }, []);\n    // функции обратного вызова для управления поведением карточки\n    const handleCardLike = (card) => {\n        const isLiked = card.likes.some(like => like._id === currentUser._id);\n\n        renderResponse(api.changeLikeCardStatus(card._id, !isLiked), newCard => {\n            setCards((prevState) => {\n                return prevState.map( stateItem => {\n                    return stateItem._id === card._id ? newCard : stateItem;\n                });\n            });\n        }, finallyHandler);\n    }\n\n    const handleCardDelete = (card) => {\n\n        renderResponse(api.deleteCard(card._id), () => {\n            setCards(prevState => {\n                return prevState.filter( stateItem => stateItem._id !== card._id)\n            });\n        }, finallyHandler);\n\n    }\n\n    const handleAddMestoCard = ({name, link}) => {\n        setIsLoading(true);\n        renderResponse(api.postCard({name: name, link: link}), newCardData => {\n            setCards([newCardData, ...cards]);\n            setIsLoading(false);\n            closeAllPopups();\n        }, finallyHandler);\n    }\n\n    // функции обратного вызова для управления данными пользователя\n\n    const handleUpdateUser = ({name, about}) => {\n        setIsLoading(true);\n        renderResponse(api.updateUserInfo({fio: name, aboutYourself: about}),data => {\n            setCurrentUser({...currentUser, name: data.name, about: data.about})\n            setIsLoading(false);\n            closeAllPopups();\n        }, finallyHandler);\n\n    }\n\n    const handleUpdateAvatar = ({avatar}) => {\n        setIsLoading(true);\n        renderResponse(api.updateAvatar({avatar}), data => {\n            setCurrentUser({...currentUser, avatar: data.avatar});\n            setIsLoading(false);\n            closeAllPopups();\n        }, finallyHandler);\n    }\n\n\n    // функции обратного вызова для окткрытия/закрытия попапов\n    const handleEditAvatarClick = () => {\n        setEditAvatarState(true);\n    }\n    const handleEditProfileClick = () => {\n        setEditProfileState(true);\n    }\n    const handleAddPlaceClick = () => {\n        setAddPlaceState(true);\n    }\n    const closeAllPopups = () => {\n        setEditProfileState(false);\n        setAddPlaceState(false);\n        setEditAvatarState(false)\n        setSelectedCard({});\n    }\n\n    const handleCardClick = (card) => {\n        setSelectedCard(card);\n    }\n\n\n  return (\n      <CurrentUserContext.Provider value={currentUser}>\n\n\n          <Switch>\n\n              <ProtectedComponent component={Main}\n                                  path=\"/\"\n                                  exact={true}\n                                  isLoggedIn={isLoggedIn}\n                                  onEditProfile={handleEditProfileClick}\n                                  onAddPlace={handleAddPlaceClick}\n                                  onEditAvatar={handleEditAvatarClick}\n                                  onCardClick={handleCardClick}\n                                  onCardLike={handleCardLike}\n                                  onCardDelete={handleCardDelete}\n                                  cards={cards} />\n              <Route path=\"/sign-up\">\n                  <Header />\n                  <Register />\n              </Route>\n              <Route path=\"/sign-in\">\n                  <Header />\n                  <Login />\n              </Route>\n          </Switch>\n        <Footer />\n          <EditProfilePopup isOpen={editProfileState}\n                            onClose={closeAllPopups}\n                            onUserUpdate={handleUpdateUser}\n                            isLoading={isLoading}/>\n\n          <EditAvatarPopup isOpen={editAvatarState}\n                           onClose={closeAllPopups}\n                           onUpdateAvatar={handleUpdateAvatar}\n                           isLoading={isLoading}/>\n\n          <AddPlacePopup isOpen={addPlaceState}\n                         onClose={closeAllPopups}\n                         onAddCard={handleAddMestoCard}\n                         isLoading={isLoading}/>\n\n          <PopupWithForm name={\"confirm\"} title={\"Вы уверены?\"}/>\n\n          <ImagePopup card={selectedCard} onClose={closeAllPopups}/>\n\n      </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}